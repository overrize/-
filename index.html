<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <title>å¹´è´§æ¸…å•åŠ©æ‰‹</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        /* ========== å¾®ä¿¡å…¼å®¹åŸºç¡€æ ·å¼ ========== */
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f5f5;  /* å¾®ä¿¡é£æ ¼æµ…ç°èƒŒæ™¯ */
            color: #333;
            min-height: 100vh;
            padding-bottom: env(safe-area-inset-bottom);
            line-height: 1.6;
        }

        /* ========== å¾®ä¿¡é£æ ¼ç»„ä»¶ ========== */
        
        /* é¡¶éƒ¨å¯¼èˆªæ  - å¾®ä¿¡é£æ ¼ */
        .wx-header {
            background: #fff;
            border-bottom: 1px solid #e5e5e5;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            padding-top: env(safe-area-inset-top);
        }

        .wx-header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            height: 44px;
        }

        .wx-title {
            font-size: 17px;
            font-weight: 600;
            color: #000;
            flex: 1;
            text-align: center;
        }

        .wx-back, .wx-action {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #576b95;
        }

        /* ä¸»å†…å®¹åŒº */
        .wx-container {
            padding-top: calc(44px + env(safe-area-inset-top));
            padding-bottom: 100px;
            max-width: 100%;
        }

        /* å¾®ä¿¡å¡ç‰‡ - æ— ç»ç’ƒæ•ˆæœï¼Œçº¯ç™½è‰² */
        .wx-card {
            background: #fff;
            margin: 12px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .wx-card-header {
            padding: 16px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .wx-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }

        .wx-card-title {
            font-size: 16px;
            font-weight: 600;
            color: #000;
        }

        .wx-card-subtitle {
            font-size: 13px;
            color: #999;
            margin-top: 2px;
        }

        /* è¾“å…¥åŒºåŸŸ */
        .wx-input-wrap {
            padding: 12px 16px;
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .wx-input {
            flex: 1;
            height: 40px;
            background: #f7f7f7;
            border: 1px solid #e5e5e5;
            border-radius: 6px;
            padding: 0 12px;
            font-size: 15px;
            color: #333;
            outline: none;
            -webkit-appearance: none;
        }

        .wx-input:focus {
            border-color: #07c160;
            background: #fff;
        }

        .wx-btn {
            height: 40px;
            padding: 0 20px;
            background: #07c160;  /* å¾®ä¿¡ç»¿ */
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
        }

        .wx-btn:active {
            opacity: 0.8;
        }

        .wx-btn-secondary {
            background: #f2f2f2;
            color: #576b95;
        }

        /* å¿«é€Ÿæ ‡ç­¾ */
        .wx-tags {
            display: flex;
            gap: 8px;
            padding: 0 16px 12px;
            overflow-x: auto;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
        }

        .wx-tag {
            padding: 6px 12px;
            background: #f2f2f2;
            border-radius: 4px;
            font-size: 13px;
            color: #576b95;
            border: none;
            display: inline-block;
        }

        .wx-tag:active {
            background: #e5e5e5;
        }

        /* åˆ—è¡¨é¡¹ - å¾®ä¿¡é£æ ¼ */
        .wx-list {
            background: #fff;
        }

        .wx-item {
            display: flex;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid #f0f0f0;
            position: relative;
        }

        .wx-item:last-child {
            border-bottom: none;
        }

        .wx-checkbox {
            width: 22px;
            height: 22px;
            border: 2px solid #c9c9c9;
            border-radius: 50%;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            background: #fff;
        }

        .wx-checkbox.checked {
            background: #07c160;
            border-color: #07c160;
        }

        .wx-checkbox.checked::after {
            content: 'âœ“';
            color: white;
            font-size: 14px;
            font-weight: bold;
        }

        .wx-item-content {
            flex: 1;
            min-width: 0;
        }

        .wx-item-title {
            font-size: 16px;
            color: #000;
            margin-bottom: 6px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .wx-item-title.completed {
            color: #999;
            text-decoration: line-through;
        }

        .wx-item-meta {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .wx-badge {
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 3px;
            background: #f2f2f2;
            color: #666;
        }

        .wx-badge.food { background: #e8f5e9; color: #2e7d32; }
        .wx-badge.snacks { background: #fff3e0; color: #ef6c00; }
        .wx-badge.gifts { background: #ffebee; color: #c62828; }
        .wx-badge.decor { background: #f3e5f5; color: #6a1b9a; }

        /* æ“ä½œæŒ‰é’®ç»„ */
        .wx-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .wx-link-btn {
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 13px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .wx-link-taobao {
            background: #fff0e8;
            color: #ff5000;
        }

        .wx-link-jd {
            background: #ffebee;
            color: #e4393c;
        }

        .wx-delete {
            color: #999;
            font-size: 18px;
            padding: 8px;
            margin: -8px;
        }

        /* åº•éƒ¨æ“ä½œæ  */
        .wx-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #fff;
            border-top: 1px solid #e5e5e5;
            padding: 12px 16px calc(12px + env(safe-area-inset-bottom));
            display: flex;
            gap: 12px;
            z-index: 100;
        }

        .wx-footer-btn {
            flex: 1;
            height: 44px;
            border-radius: 6px;
            font-size: 15px;
            font-weight: 500;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .wx-footer-btn.primary {
            background: #07c160;
            color: white;
        }

        .wx-footer-btn.secondary {
            background: #f2f2f2;
            color: #576b95;
        }

        /* ç©ºçŠ¶æ€ */
        .wx-empty {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .wx-empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        /* å¼¹çª— - å¾®ä¿¡é£æ ¼ */
        .wx-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .wx-modal.show {
            display: flex;
        }

        .wx-modal-content {
            background: #fff;
            border-radius: 12px;
            width: 100%;
            max-width: 300px;
            overflow: hidden;
        }

        .wx-modal-header {
            padding: 24px 24px 16px;
            text-align: center;
        }

        .wx-modal-title {
            font-size: 17px;
            font-weight: 600;
            color: #000;
            margin-bottom: 8px;
        }

        .wx-modal-body {
            padding: 0 24px 24px;
            text-align: center;
        }

        .wx-qrcode-wrap {
            background: #f7f7f7;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .wx-modal-footer {
            display: flex;
            border-top: 1px solid #e5e5e5;
        }

        .wx-modal-btn {
            flex: 1;
            height: 50px;
            border: none;
            background: #fff;
            font-size: 16px;
            color: #000;
            font-weight: 500;
        }

        .wx-modal-btn.primary {
            color: #576b95;
            border-left: 1px solid #e5e5e5;
        }

        .wx-modal-btn:active {
            background: #f2f2f2;
        }

        /* Toast */
        .wx-toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            z-index: 9999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
        }

        .wx-toast.show {
            opacity: 1;
        }

        /* åˆ†ç±»ç­›é€‰ */
        .wx-tabs {
            display: flex;
            background: #fff;
            border-bottom: 1px solid #e5e5e5;
            overflow-x: auto;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
        }

        .wx-tab {
            padding: 12px 16px;
            font-size: 15px;
            color: #666;
            position: relative;
            border: none;
            background: none;
        }

        .wx-tab.active {
            color: #07c160;
            font-weight: 600;
        }

        .wx-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 16px;
            right: 16px;
            height: 2px;
            background: #07c160;
        }
    </style>
</head>
<body>

    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <header class="wx-header">
        <div class="wx-header-content">
            <div class="wx-back" onclick="history.back()">â€¹</div>
            <div class="wx-title">å¹´è´§æ¸…å•åŠ©æ‰‹ ğŸ§§</div>
            <div class="wx-action" onclick="showQR()">â‹®</div>
        </div>
    </header>

    <!-- ä¸»å†…å®¹ -->
    <div class="wx-container">
        
        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="wx-card" style="margin-top: 12px;">
            <div class="wx-card-header">
                <div class="wx-icon">ğŸ§§</div>
                <div>
                    <div class="wx-card-title">å¾…è´­ä¹° <span id="pendingCount">0</span> é¡¹</div>
                    <div class="wx-card-subtitle">å·²å®Œæˆ <span id="completedCount">0</span> é¡¹</div>
                </div>
            </div>
            
            <!-- åˆ†ç±»æ ‡ç­¾ -->
            <div class="wx-tabs">
                <button class="wx-tab active" onclick="setCat('all')">å…¨éƒ¨</button>
                <button class="wx-tab" onclick="setCat('food')">é£Ÿå“</button>
                <button class="wx-tab" onclick="setCat('snacks')">é›¶é£Ÿ</button>
                <button class="wx-tab" onclick="setCat('gifts')">ç¤¼å“</button>
                <button class="wx-tab" onclick="setCat('decor')">è£…é¥°</button>
            </div>

            <!-- è¾“å…¥åŒº -->
            <div class="wx-input-wrap">
                <input type="text" class="wx-input" id="itemInput" placeholder="è¾“å…¥è¦ä¹°çš„ä¸œè¥¿..." onkeypress="handleEnter(event)">
                <button class="wx-btn" onclick="addItem()">æ·»åŠ </button>
            </div>

            <!-- å¿«é€Ÿæ ‡ç­¾ -->
            <div class="wx-tags">
                <span class="wx-tag" onclick="quickAdd('åšæœç¤¼ç›’')">åšæœç¤¼ç›’</span>
                <span class="wx-tag" onclick="quickAdd('ç³–æœ')">ç³–æœ</span>
                <span class="wx-tag" onclick="quickAdd('å¯¹è”')">å¯¹è”</span>
                <span class="wx-tag" onclick="quickAdd('çº¢åŒ…')">çº¢åŒ…</span>
                <span class="wx-tag" onclick="quickAdd('è½¦å˜å­')">è½¦å˜å­</span>
            </div>
        </div>

        <!-- æ¸…å•åˆ—è¡¨ -->
        <div class="wx-card">
            <div id="itemList" class="wx-list">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div id="emptyState" class="wx-empty" style="display: none;">
                <div class="wx-empty-icon">ğŸ›’</div>
                <div>æ¸…å•è¿˜æ˜¯ç©ºçš„</div>
                <div style="font-size: 13px; margin-top: 8px;">ç‚¹å‡»ä¸Šæ–¹å¿«é€Ÿæ ‡ç­¾æ·»åŠ </div>
            </div>
        </div>

        <!-- æ“ä½œæç¤º -->
        <div style="padding: 20px; text-align: center; color: #999; font-size: 13px;">
            ğŸ’¡ æç¤ºï¼šç‚¹å‡»"å¤åˆ¶é“¾æ¥"åï¼Œå¯ç²˜è´´åˆ°æ·˜å®/äº¬ä¸œæœç´¢
        </div>
    </div>

    <!-- åº•éƒ¨æ“ä½œæ  -->
    <div class="wx-footer">
        <button class="wx-footer-btn secondary" onclick="copyTaobao()">
            <span>ğŸ‘</span> å¤åˆ¶æ·˜å®é“¾æ¥
        </button>
        <button class="wx-footer-btn secondary" onclick="copyJD()">
            <span>ğŸ•</span> å¤åˆ¶äº¬ä¸œé“¾æ¥
        </button>
        <button class="wx-footer-btn primary" onclick="showQR()">
            <span>ğŸ“±</span> åˆ†äº«
        </button>
    </div>

    <!-- äºŒç»´ç å¼¹çª— -->
    <div class="wx-modal" id="qrModal">
        <div class="wx-modal-content">
            <div class="wx-modal-header">
                <div class="wx-modal-title">åˆ†äº«å¹´è´§æ¸…å•</div>
            </div>
            <div class="wx-modal-body">
                <div class="wx-qrcode-wrap">
                    <div id="qrcode"></div>
                </div>
                <div style="font-size: 13px; color: #666; line-height: 1.5;">
                    å¾®ä¿¡æ‰«ç å³å¯æŸ¥çœ‹<br>
                    å»ºè®®æˆªå›¾ä¿å­˜åˆ°ç›¸å†Œ
                </div>
            </div>
            <div class="wx-modal-footer">
                <button class="wx-modal-btn" onclick="closeQR()">å…³é—­</button>
                <button class="wx-modal-btn primary" onclick="saveQR()">ä¿å­˜å›¾ç‰‡</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="wx-toast" id="toast"></div>

    <script>
        // æ•°æ®
        let items = JSON.parse(localStorage.getItem('nyItems2024') || '[]');
        let currentCat = 'all';

        const categories = {
            food: { name: 'é£Ÿå“', class: 'food' },
            snacks: { name: 'é›¶é£Ÿ', class: 'snacks' },
            gifts: { name: 'ç¤¼å“', class: 'gifts' },
            decor: { name: 'è£…é¥°', class: 'decor' },
            other: { name: 'å…¶ä»–', class: '' }
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            render();
            updateStats();
        });

        function render() {
            const list = document.getElementById('itemList');
            const empty = document.getElementById('emptyState');
            
            let filtered = items;
            if (currentCat !== 'all') {
                filtered = items.filter(i => i.category === currentCat);
            }

            if (filtered.length === 0) {
                list.innerHTML = '';
                empty.style.display = 'block';
                return;
            }

            empty.style.display = 'none';
            
            list.innerHTML = filtered.map(item => {
                const cat = categories[item.category];
                return `
                    <div class="wx-item">
                        <div class="wx-checkbox ${item.completed ? 'checked' : ''}" onclick="toggle(${item.id})"></div>
                        <div class="wx-item-content">
                            <div class="wx-item-title ${item.completed ? 'completed' : ''}">${item.name}</div>
                            <div class="wx-item-meta">
                                <span class="wx-badge ${cat.class}">${cat.name}</span>
                                ${!item.completed ? `
                                <span class="wx-link-btn wx-link-taobao" onclick="copyItem('taobao', '${item.name}')">å¤åˆ¶æ·˜å®</span>
                                <span class="wx-link-btn wx-link-jd" onclick="copyItem('jd', '${item.name}')">å¤åˆ¶äº¬ä¸œ</span>
                                ` : ''}
                            </div>
                        </div>
                        <span class="wx-delete" onclick="del(${item.id})">ğŸ—‘ï¸</span>
                    </div>
                `;
            }).join('');
        }

        function addItem() {
            const input = document.getElementById('itemInput');
            const name = input.value.trim();
            if (!name) return showToast('è¯·è¾“å…¥å•†å“åç§°');

            let cat = 'other';
            if (/åšæœ|æ°´æœ|è‚‰|æµ·é²œ|è”¬èœ|è›‹|å¥¶/i.test(name)) cat = 'food';
            else if (/ç³–|å·§å…‹åŠ›|é¥¼å¹²|è–¯ç‰‡|é¥®æ–™|é…’|èŒ¶/i.test(name)) cat = 'snacks';
            else if (/ç¤¼ç›’|ç¤¼|é€|é•¿è¾ˆ/i.test(name)) cat = 'gifts';
            else if (/å¯¹è”|ç¦|ç¯ç¬¼|çº¢åŒ…|çª—èŠ±/i.test(name)) cat = 'decor';

            items.unshift({
                id: Date.now(),
                name: name,
                category: cat,
                completed: false,
                createdAt: Date.now()
            });

            save();
            input.value = '';
            render();
            updateStats();
            showToast('å·²æ·»åŠ ');
        }

        function quickAdd(name) {
            document.getElementById('itemInput').value = name;
            addItem();
        }

        function toggle(id) {
            const item = items.find(i => i.id === id);
            if (item) {
                item.completed = !item.completed;
                save();
                render();
                updateStats();
            }
        }

        function del(id) {
            if (confirm('ç¡®å®šåˆ é™¤ï¼Ÿ')) {
                items = items.filter(i => i.id !== id);
                save();
                render();
                updateStats();
            }
        }

        function setCat(cat) {
            currentCat = cat;
            document.querySelectorAll('.wx-tab').forEach((tab, idx) => {
                const cats = ['all', 'food', 'snacks', 'gifts', 'decor'];
                tab.classList.toggle('active', cats[idx] === cat);
            });
            render();
        }

        function copyItem(platform, name) {
            const url = platform === 'taobao' 
                ? `https://s.taobao.com/search?q=${encodeURIComponent(name)}`
                : `https://so.m.jd.com/ware/search.action?keyword=${encodeURIComponent(name)}`;
            
            copyToClipboard(`${name}\n${url}`, platform === 'taobao' ? 'æ·˜å®é“¾æ¥å·²å¤åˆ¶' : 'äº¬ä¸œé“¾æ¥å·²å¤åˆ¶');
        }

        function copyTaobao() {
            const pending = items.filter(i => !i.completed);
            if (pending.length === 0) return showToast('æ²¡æœ‰å¾…è´­ä¹°å•†å“');
            
            const text = pending.map((item, i) => `${i+1}. ${item.name}\nhttps://s.taobao.com/search?q=${encodeURIComponent(item.name)}`).join('\n\n');
            copyToClipboard('ğŸ‘ æ·˜å®å¹´è´§æ¸…å•\n\n' + text, 'æ·˜å®é“¾æ¥å·²å¤åˆ¶');
        }

        function copyJD() {
            const pending = items.filter(i => !i.completed);
            if (pending.length === 0) return showToast('æ²¡æœ‰å¾…è´­ä¹°å•†å“');
            
            const text = pending.map((item, i) => `${i+1}. ${item.name}\nhttps://so.m.jd.com/ware/search.action?keyword=${encodeURIComponent(item.name)}`).join('\n\n');
            copyToClipboard('ğŸ• äº¬ä¸œå¹´è´§æ¸…å•\n\n' + text, 'äº¬ä¸œé“¾æ¥å·²å¤åˆ¶');
        }

        function copyToClipboard(text, msg) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => showToast(msg));
            } else {
                const input = document.createElement('textarea');
                input.value = text;
                document.body.appendChild(input);
                input.select();
                document.execCommand('copy');
                document.body.removeChild(input);
                showToast(msg);
            }
        }

        function showQR() {
            document.getElementById('qrModal').classList.add('show');
            document.getElementById('qrcode').innerHTML = '';
            new QRCode(document.getElementById('qrcode'), {
                text: window.location.href,
                width: 150,
                height: 150,
                colorDark: '#000',
                colorLight: '#fff'
            });
        }

        function closeQR() {
            document.getElementById('qrModal').classList.remove('show');
        }

        function saveQR() {
            const canvas = document.querySelector('#qrcode canvas');
            if (canvas) {
                const link = document.createElement('a');
                link.download = 'å¹´è´§æ¸…å•äºŒç»´ç .png';
                link.href = canvas.toDataURL();
                link.click();
                showToast('å·²ä¿å­˜');
            }
        }

        function updateStats() {
            const pending = items.filter(i => !i.completed).length;
            const completed = items.filter(i => i.completed).length;
            document.getElementById('pendingCount').textContent = pending;
            document.getElementById('completedCount').textContent = completed;
        }

        function save() {
            localStorage.setItem('nyItems2024', JSON.stringify(items));
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }

        function handleEnter(e) {
            if (e.key === 'Enter') addItem();
        }

        // ç‚¹å‡»é®ç½©å…³é—­å¼¹çª—
        document.getElementById('qrModal').addEventListener('click', function(e) {
            if (e.target === this) closeQR();
        });
    </script>
</body>
</html>